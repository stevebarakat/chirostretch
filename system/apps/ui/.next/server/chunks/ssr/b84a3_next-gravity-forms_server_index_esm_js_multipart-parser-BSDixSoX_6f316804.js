module.exports=[21622,a=>{"use strict";a.i(2157),a.i(50227);var b=a.i(53963);a.i(47299),a.i(43698),a.i(27028),a.i(81111),a.i(51615),a.i(12057),a.i(57764),a.i(61095),a.i(34496);let c=0,d={START_BOUNDARY:c++,HEADER_FIELD_START:c++,HEADER_FIELD:c++,HEADER_VALUE_START:c++,HEADER_VALUE:c++,HEADER_VALUE_ALMOST_DONE:c++,HEADERS_ALMOST_DONE:c++,PART_DATA_START:c++,PART_DATA:c++,END:c++},e=a=>32|a,f=()=>{};class g{constructor(a){this.index=0,this.flags=0,this.onHeaderEnd=f,this.onHeaderField=f,this.onHeadersEnd=f,this.onHeaderValue=f,this.onPartBegin=f,this.onPartData=f,this.onPartEnd=f,this.boundaryChars={};const b=new Uint8Array((a="\r\n--"+a).length);for(let c=0;c<a.length;c++)b[c]=a.charCodeAt(c),this.boundaryChars[b[c]]=!0;this.boundary=b,this.lookbehind=new Uint8Array(this.boundary.length+8),this.state=d.START_BOUNDARY}write(a){let b,c,f=0,g=a.length,h=this.index,{lookbehind:i,boundary:j,boundaryChars:k,index:l,state:m,flags:n}=this,o=this.boundary.length,p=o-1,q=a.length,r=a=>{this[a+"Mark"]=f},s=a=>{delete this[a+"Mark"]},t=(a,b,c,d)=>{void 0!==b&&b===c||this[a](d&&d.subarray(b,c))},u=(b,c)=>{let d=b+"Mark";d in this&&(c?(t(b,this[d],f,a),delete this[d]):(t(b,this[d],a.length,a),this[d]=0))};for(f=0;f<g;f++)switch(b=a[f],m){case d.START_BOUNDARY:if(l===j.length-2){if(45===b)n|=2;else if(13!==b)return;l++;break}if(l-1==j.length-2){if(2&n&&45===b)m=d.END,n=0;else{if(2&n||10!==b)return;l=0,t("onPartBegin"),m=d.HEADER_FIELD_START}break}b!==j[l+2]&&(l=-2),b===j[l+2]&&l++;break;case d.HEADER_FIELD_START:m=d.HEADER_FIELD,r("onHeaderField"),l=0;case d.HEADER_FIELD:if(13===b){s("onHeaderField"),m=d.HEADERS_ALMOST_DONE;break}if(l++,45===b)break;if(58===b){if(1===l)return;u("onHeaderField",!0),m=d.HEADER_VALUE_START;break}if((c=e(b))<97||c>122)return;break;case d.HEADER_VALUE_START:if(32===b)break;r("onHeaderValue"),m=d.HEADER_VALUE;case d.HEADER_VALUE:13===b&&(u("onHeaderValue",!0),t("onHeaderEnd"),m=d.HEADER_VALUE_ALMOST_DONE);break;case d.HEADER_VALUE_ALMOST_DONE:if(10!==b)return;m=d.HEADER_FIELD_START;break;case d.HEADERS_ALMOST_DONE:if(10!==b)return;t("onHeadersEnd"),m=d.PART_DATA_START;break;case d.PART_DATA_START:m=d.PART_DATA,r("onPartData");case d.PART_DATA:if(h=l,0===l){for(f+=p;f<q&&!(a[f]in k);)f+=o;f-=p,b=a[f]}if(l<j.length)j[l]===b?(0===l&&u("onPartData",!0),l++):l=0;else if(l===j.length)l++,13===b?n|=1:45===b?n|=2:l=0;else if(l-1===j.length)if(1&n){if(l=0,10===b){n&=-2,t("onPartEnd"),t("onPartBegin"),m=d.HEADER_FIELD_START;break}}else 2&n&&45===b?(t("onPartEnd"),m=d.END,n=0):l=0;l>0?i[l-1]=b:h>0&&(t("onPartData",0,h,new Uint8Array(i.buffer,i.byteOffset,i.byteLength)),h=0,r("onPartData"),f--);break;case d.END:break;default:throw Error(`Unexpected state entered: ${m}`)}u("onHeaderField"),u("onHeaderValue"),u("onPartData"),this.index=l,this.state=m,this.flags=n}end(){if(this.state===d.HEADER_FIELD_START&&0===this.index||this.state===d.PART_DATA&&this.index===this.boundary.length)this.onPartEnd();else if(this.state!==d.END)throw Error("MultipartParser.end(): stream ended unexpectedly")}}async function h(a,c){let d,e,f,h,i,j;if(!/multipart/i.test(c))throw TypeError("Failed to fetch");let k=c.match(/boundary=(?:"([^"]+)"|([^;]+))/i);if(!k)throw TypeError("no or bad content-type header, no multipart boundary");let l=new g(k[1]||k[2]),m=[],n=new b.F,o=a=>{f+=s.decode(a,{stream:!0})},p=a=>{m.push(a)},q=()=>{let a=new b.a(m,j,{type:i});n.append(h,a)},r=()=>{n.append(h,f)},s=new TextDecoder("utf-8");for await(let b of(s.decode(),l.onPartBegin=function(){l.onPartData=o,l.onPartEnd=r,d="",e="",f="",h="",i="",j=null,m.length=0},l.onHeaderField=function(a){d+=s.decode(a,{stream:!0})},l.onHeaderValue=function(a){e+=s.decode(a,{stream:!0})},l.onHeaderEnd=function(){if(e+=s.decode(),"content-disposition"===(d=d.toLowerCase())){let a=e.match(/\bname=("([^"]*)"|([^()<>@,;:\\"/[\]?={}\s\t]+))/i);a&&(h=a[2]||a[3]||""),(j=function(a){let b=a.match(/\bfilename=("(.*?)"|([^()<>@,;:\\"/[\]?={}\s\t]+))($|;\s)/i);if(!b)return;let c=b[2]||b[3]||"",d=c.slice(c.lastIndexOf("\\")+1);return(d=d.replace(/%22/g,'"')).replace(/&#(\d{4});/g,(a,b)=>String.fromCharCode(b))}(e))&&(l.onPartData=p,l.onPartEnd=q)}else"content-type"===d&&(i=e);e="",d=""},a))l.write(b);return l.end(),n}a.s(["toFormData",()=>h])}];

//# sourceMappingURL=b84a3_next-gravity-forms_server_index_esm_js_multipart-parser-BSDixSoX_6f316804.js.map