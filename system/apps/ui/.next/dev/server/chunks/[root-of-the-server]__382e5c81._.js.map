{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///Users/sb/Dev/chirostretch/src/lib/commerce/storeApi.ts"],"sourcesContent":["import { cookies } from \"next/headers\";\nimport { NextResponse } from \"next/server\";\n\nconst WP_URL = process.env.NEXT_PUBLIC_BACKEND_URL;\n\ntype StoreApiOptions = {\n  method: \"GET\" | \"POST\" | \"PUT\" | \"DELETE\";\n  path: string;\n  body?: unknown;\n};\n\n/**\n * Make a request to WooCommerce Store API with session cookie forwarding\n */\nexport async function storeApiFetch({ method, path, body }: StoreApiOptions) {\n  const cookieStore = await cookies();\n\n  // Build cookie header for WC session\n  // Forward all WooCommerce-related cookies\n  const wcCookies = cookieStore\n    .getAll()\n    .filter(\n      (c) =>\n        c.name.startsWith(\"wp_woocommerce_session\") ||\n        c.name.startsWith(\"woocommerce_\")\n    )\n    .map((cookie) => `${cookie.name}=${cookie.value}`)\n    .join(\"; \");\n\n  const headers: Record<string, string> = {\n    \"Content-Type\": \"application/json\",\n  };\n\n  if (wcCookies) {\n    headers[\"cookie\"] = wcCookies;\n  }\n\n  const res = await fetch(`${WP_URL}/wp-json/wc/store/v1${path}`, {\n    method,\n    headers,\n    body: body ? JSON.stringify(body) : undefined,\n    cache: \"no-store\",\n  });\n\n  let data: unknown;\n  const text = await res.text();\n  try {\n    data = JSON.parse(text);\n  } catch {\n    // Response wasn't JSON (could be HTML error page)\n    console.error(\n      \"[storeApiFetch] Non-JSON response:\",\n      res.status,\n      text.substring(0, 500)\n    );\n    data = { error: \"Store API error\", status: res.status };\n  }\n\n  // Collect Set-Cookie headers to forward\n  const setCookieHeaders: string[] = [];\n  const rawSetCookie = res.headers.get(\"set-cookie\");\n  if (rawSetCookie) {\n    setCookieHeaders.push(\n      ...rawSetCookie.split(/,(?=\\s*(?:woocommerce_|wp_woocommerce_))/)\n    );\n  }\n\n  return {\n    data,\n    status: res.status,\n    setCookieHeaders,\n  };\n}\n\n/**\n * Create a NextResponse with WC session cookies forwarded\n */\nexport function createCartResponse(\n  data: unknown,\n  status: number,\n  setCookieHeaders: string[]\n) {\n  const response = NextResponse.json(data, { status });\n\n  // Forward WooCommerce session cookies\n  for (const cookieHeader of setCookieHeaders) {\n    response.headers.append(\"Set-Cookie\", cookieHeader);\n  }\n\n  return response;\n}\n"],"names":[],"mappings":";;;;;;AAAA;AACA;;;AAEA,MAAM;AAWC,eAAe,cAAc,EAAE,MAAM,EAAE,IAAI,EAAE,IAAI,EAAmB;IACzE,MAAM,cAAc,MAAM,IAAA,oVAAO;IAEjC,qCAAqC;IACrC,0CAA0C;IAC1C,MAAM,YAAY,YACf,MAAM,GACN,MAAM,CACL,CAAC,IACC,EAAE,IAAI,CAAC,UAAU,CAAC,6BAClB,EAAE,IAAI,CAAC,UAAU,CAAC,iBAErB,GAAG,CAAC,CAAC,SAAW,GAAG,OAAO,IAAI,CAAC,CAAC,EAAE,OAAO,KAAK,EAAE,EAChD,IAAI,CAAC;IAER,MAAM,UAAkC;QACtC,gBAAgB;IAClB;IAEA,IAAI,WAAW;QACb,OAAO,CAAC,SAAS,GAAG;IACtB;IAEA,MAAM,MAAM,MAAM,MAAM,GAAG,OAAO,oBAAoB,EAAE,MAAM,EAAE;QAC9D;QACA;QACA,MAAM,OAAO,KAAK,SAAS,CAAC,QAAQ;QACpC,OAAO;IACT;IAEA,IAAI;IACJ,MAAM,OAAO,MAAM,IAAI,IAAI;IAC3B,IAAI;QACF,OAAO,KAAK,KAAK,CAAC;IACpB,EAAE,OAAM;QACN,kDAAkD;QAClD,QAAQ,KAAK,CACX,sCACA,IAAI,MAAM,EACV,KAAK,SAAS,CAAC,GAAG;QAEpB,OAAO;YAAE,OAAO;YAAmB,QAAQ,IAAI,MAAM;QAAC;IACxD;IAEA,wCAAwC;IACxC,MAAM,mBAA6B,EAAE;IACrC,MAAM,eAAe,IAAI,OAAO,CAAC,GAAG,CAAC;IACrC,IAAI,cAAc;QAChB,iBAAiB,IAAI,IAChB,aAAa,KAAK,CAAC;IAE1B;IAEA,OAAO;QACL;QACA,QAAQ,IAAI,MAAM;QAClB;IACF;AACF;AAKO,SAAS,mBACd,IAAa,EACb,MAAc,EACd,gBAA0B;IAE1B,MAAM,WAAW,wVAAY,CAAC,IAAI,CAAC,MAAM;QAAE;IAAO;IAElD,sCAAsC;IACtC,KAAK,MAAM,gBAAgB,iBAAkB;QAC3C,SAAS,OAAO,CAAC,MAAM,CAAC,cAAc;IACxC;IAEA,OAAO;AACT"}},
    {"offset": {"line": 112, "column": 0}, "map": {"version":3,"sources":["file:///Users/sb/Dev/chirostretch/src/app/api/cart/route.ts"],"sourcesContent":["import { storeApiFetch, createCartResponse } from \"@/lib/commerce/storeApi\";\n\nexport async function GET() {\n  try {\n    const { data, status, setCookieHeaders } = await storeApiFetch({\n      method: \"GET\",\n      path: \"/cart\",\n    });\n\n    return createCartResponse(data, status, setCookieHeaders);\n  } catch (error) {\n    console.error(\"Error fetching cart:\", error);\n    return createCartResponse({ error: \"Failed to fetch cart\" }, 500, []);\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;;AAEO,eAAe;IACpB,IAAI;QACF,MAAM,EAAE,IAAI,EAAE,MAAM,EAAE,gBAAgB,EAAE,GAAG,MAAM,IAAA,qJAAa,EAAC;YAC7D,QAAQ;YACR,MAAM;QACR;QAEA,OAAO,IAAA,0JAAkB,EAAC,MAAM,QAAQ;IAC1C,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,wBAAwB;QACtC,OAAO,IAAA,0JAAkB,EAAC;YAAE,OAAO;QAAuB,GAAG,KAAK,EAAE;IACtE;AACF"}}]
}