{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 40, "column": 0}, "map": {"version":3,"sources":["file:///Users/sb/Dev/chirostretch/src/app/api/bookings/add-to-cart/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\";\nimport { cookies } from \"next/headers\";\n\nconst WP_URL = process.env.NEXT_PUBLIC_BACKEND_URL;\n\nexport async function POST(request: NextRequest) {\n  try {\n    const body = await request.json();\n    const { productId, date, time, resourceId } = body;\n\n    if (!productId || !date || !time) {\n      return NextResponse.json(\n        { error: \"productId, date, and time are required\" },\n        { status: 400 }\n      );\n    }\n\n    const cookieStore = await cookies();\n    const cookieHeader = cookieStore\n      .getAll()\n      .filter(\n        (c) =>\n          c.name.startsWith(\"wp_woocommerce_session\") ||\n          c.name.startsWith(\"woocommerce_\")\n      )\n      .map((cookie) => `${cookie.name}=${cookie.value}`)\n      .join(\"; \");\n\n    const res = await fetch(\n      `${WP_URL}/wp-json/chirostretch/v1/bookings/add-to-cart`,\n      {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n          ...(cookieHeader ? { cookie: cookieHeader } : {}),\n        },\n        body: JSON.stringify({\n          productId,\n          date,\n          time,\n          resourceId,\n        }),\n        cache: \"no-store\",\n      }\n    );\n\n    const data = await res.json();\n\n    // Forward WooCommerce session cookies\n    const response = NextResponse.json(data, { status: res.status });\n\n    const setCookie = res.headers.get(\"set-cookie\");\n    if (setCookie) {\n      const cookies = setCookie.split(\n        /,(?=\\s*(?:woocommerce_|wp_woocommerce_))/\n      );\n      for (const cookie of cookies) {\n        response.headers.append(\"Set-Cookie\", cookie);\n      }\n    }\n\n    return response;\n  } catch (error) {\n    console.error(\"Error adding booking to cart:\", error);\n    return NextResponse.json(\n      { error: \"Failed to add booking to cart\" },\n      { status: 500 }\n    );\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEA,MAAM;AAEC,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,MAAM,OAAO,MAAM,QAAQ,IAAI;QAC/B,MAAM,EAAE,SAAS,EAAE,IAAI,EAAE,IAAI,EAAE,UAAU,EAAE,GAAG;QAE9C,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,MAAM;YAChC,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAyC,GAClD;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,cAAc,MAAM,IAAA,4IAAO;QACjC,MAAM,eAAe,YAClB,MAAM,GACN,MAAM,CACL,CAAC,IACC,EAAE,IAAI,CAAC,UAAU,CAAC,6BAClB,EAAE,IAAI,CAAC,UAAU,CAAC,iBAErB,GAAG,CAAC,CAAC,SAAW,GAAG,OAAO,IAAI,CAAC,CAAC,EAAE,OAAO,KAAK,EAAE,EAChD,IAAI,CAAC;QAER,MAAM,MAAM,MAAM,MAChB,GAAG,OAAO,6CAA6C,CAAC,EACxD;YACE,QAAQ;YACR,SAAS;gBACP,gBAAgB;gBAChB,GAAI,eAAe;oBAAE,QAAQ;gBAAa,IAAI,CAAC,CAAC;YAClD;YACA,MAAM,KAAK,SAAS,CAAC;gBACnB;gBACA;gBACA;gBACA;YACF;YACA,OAAO;QACT;QAGF,MAAM,OAAO,MAAM,IAAI,IAAI;QAE3B,sCAAsC;QACtC,MAAM,WAAW,gJAAY,CAAC,IAAI,CAAC,MAAM;YAAE,QAAQ,IAAI,MAAM;QAAC;QAE9D,MAAM,YAAY,IAAI,OAAO,CAAC,GAAG,CAAC;QAClC,IAAI,WAAW;YACb,MAAM,UAAU,UAAU,KAAK,CAC7B;YAEF,KAAK,MAAM,UAAU,QAAS;gBAC5B,SAAS,OAAO,CAAC,MAAM,CAAC,cAAc;YACxC;QACF;QAEA,OAAO;IACT,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,iCAAiC;QAC/C,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAAgC,GACzC;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}